{"ast":null,"code":"import { toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, vModelCheckbox as _vModelCheckbox, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"row px-5\"\n};\nconst _hoisted_2 = {\n  class: \"row\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"error-message\"\n};\nconst _hoisted_4 = {\n  key: 1,\n  class: \"product-name text-center\"\n};\nconst _hoisted_5 = {\n  class: \"row ps-4 pe-3\"\n};\nconst _hoisted_6 = {\n  class: \"row\"\n};\nconst _hoisted_7 = {\n  class: \"show-name-label\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_font_awesome_icon = _resolveComponent(\"font-awesome-icon\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [$setup.errorMessage ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString($setup.errorMessage), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), (_openBlock(), _createElementBlock(\"svg\", {\n    ref: \"svgRef\",\n    key: $props.sku\n  })), $setup.showProductName ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, _toDisplayString($props.productName), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"button\", {\n    class: \"btn btn-primary fs-6\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $setup.downloadBarcode && $setup.downloadBarcode(...args))\n  }, [_cache[2] || (_cache[2] = _createElementVNode(\"span\", null, \"Download \", -1 /* HOISTED */)), _createVNode(_component_font_awesome_icon, {\n    icon: \"download\",\n    style: {\n      \"color\": \"#ffffff\"\n    }\n  })])]), _createCommentVNode(\" Toggle for controlling visibility of the product name \"), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"label\", _hoisted_7, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"checkbox\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.showProductName = $event)\n  }, null, 512 /* NEED_PATCH */), [[_vModelCheckbox, $setup.showProductName]]), _cache[3] || (_cache[3] = _createElementVNode(\"span\", {\n    class: \"text-secondary\"\n  }, \"Show Product Name\", -1 /* HOISTED */))])])]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","$setup","errorMessage","_hoisted_3","_toDisplayString","_createCommentVNode","ref","$props","sku","showProductName","_hoisted_4","productName","_hoisted_5","onClick","_cache","args","downloadBarcode","_createVNode","_component_font_awesome_icon","icon","style","_hoisted_6","_hoisted_7","type","$event"],"sources":["C:\\Users\\Administrator\\OneDrive\\Desktop\\POSExpress\\frontend\\src\\components\\Admin\\Inventory\\Barcode.vue"],"sourcesContent":["<script>\r\nimport JsBarcode from 'jsbarcode';\r\nimport { onMounted, watch, ref, nextTick } from 'vue';\r\nimport debounce from 'lodash.debounce';\r\n\r\nexport default {\r\n  props: {\r\n    sku: {\r\n      type: String,\r\n      default: '',\r\n      validator: (value) => /^\\d{0,13}$/.test(value) // Validate SKU is numeric and max 13 characters\r\n    },\r\n    productName: {\r\n      type: String,\r\n      default: 'Product Name' // Default label if no product name is provided\r\n    }\r\n  },\r\n  setup(props) {\r\n    const svgRef = ref(null);\r\n    const errorMessage = ref('');\r\n    const fallbackSku = '0000000000000';\r\n    const showProductName = ref(true); // Boolean to control visibility of product name\r\n\r\n    const calculateEAN13Checksum = (sku) => {\r\n      const digits = sku.split('').map(Number);\r\n      let sum = 0;\r\n      for (let i = 0; i < 12; i++) {\r\n        sum += (i % 2 === 0 ? digits[i] : digits[i] * 3);\r\n      }\r\n      return (10 - (sum % 10)) % 10;\r\n    };\r\n\r\n    const generateBarcode = (sku) => {\r\n      requestAnimationFrame(() => {\r\n        try {\r\n          // Use fallback SKU if no valid SKU is provided\r\n          if (!sku || typeof sku !== 'string' || sku.length === 0) {\r\n            sku = fallbackSku;\r\n          }\r\n\r\n          if (sku.length < 13) {\r\n            sku = sku.padStart(13, '0');\r\n          } else if (sku.length > 13) {\r\n            sku = sku.slice(0, 13);\r\n          }\r\n\r\n          const checksum = calculateEAN13Checksum(sku);\r\n          sku = sku.slice(0, 12) + checksum;\r\n          errorMessage.value = '';\r\n\r\n          JsBarcode(svgRef.value, sku, {\r\n            format: 'EAN13',\r\n            lineColor: '#000',\r\n            width: 2,\r\n            height: 50,\r\n            displayValue: true\r\n          });\r\n        } catch (error) {\r\n          console.error(error.message);\r\n          errorMessage.value = error.message;\r\n\r\n          JsBarcode(svgRef.value, fallbackSku, {\r\n            format: 'CODE128',\r\n            lineColor: '#000',\r\n            width: 2,\r\n            height: 50,\r\n            displayValue: true\r\n          });\r\n        }\r\n      });\r\n    };\r\n\r\n    const debouncedGenerateBarcode = debounce(generateBarcode, 300);\r\n\r\n    const sanitizeFileName = (name) => {\r\n      return name.replace(/[\\/:*?\"<>|]/g, '_').replace(/\\s+/g, '_');\r\n    };\r\n\r\n    const downloadBarcode = () => {\r\n      const svg = svgRef.value;\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      const svgData = new XMLSerializer().serializeToString(svg);\r\n      const img = new Image();\r\n      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\r\n      const url = URL.createObjectURL(svgBlob);\r\n\r\n      img.onload = () => {\r\n        canvas.width = img.width;\r\n        canvas.height = img.height + (showProductName.value ? 30 : 0); // Adjust canvas height based on visibility of product name\r\n        ctx.fillStyle = 'white';\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n        // Draw the barcode image on the canvas\r\n        ctx.drawImage(img, 0, 0);\r\n\r\n        // If showProductName is true, draw the product name\r\n        if (showProductName.value) {\r\n          ctx.font = '12px Arial';\r\n          ctx.fillStyle = 'black';\r\n          ctx.textAlign = 'center';\r\n          ctx.fillText(props.productName, canvas.width / 2, img.height + 20);\r\n        }\r\n\r\n        // Sanitize the product name for use in the file name\r\n        const sanitizedProductName = sanitizeFileName(props.productName);\r\n        const pngUrl = canvas.toDataURL('image/png');\r\n        const link = document.createElement('a');\r\n        link.href = pngUrl;\r\n        link.download = `${sanitizedProductName}_barcode.png`; // Use sanitized product name as the file name\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        URL.revokeObjectURL(url);\r\n      };\r\n      img.src = url;\r\n    };\r\n\r\n    onMounted(() => generateBarcode(props.sku));\r\n    watch(\r\n      () => props.sku,\r\n      (newSku) => {\r\n        debouncedGenerateBarcode(newSku);\r\n      },\r\n      { immediate: true } // Trigger barcode generation on mount\r\n    );\r\n\r\n    return {\r\n      svgRef,\r\n      errorMessage,\r\n      downloadBarcode,\r\n      showProductName // Return this so it can be used in the template\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div class=\"row px-5\">\r\n    <div class=\"row\">\r\n      <div v-if=\"errorMessage\" class=\"error-message\">{{ errorMessage }}</div>\r\n      <svg ref=\"svgRef\" :key=\"sku\"></svg>\r\n      <div v-if=\"showProductName\" class=\"product-name text-center\">{{ productName }}</div>\r\n    </div>\r\n    <div class=\"row ps-4 pe-3\">\r\n      <button class=\"btn btn-primary fs-6\" @click=\"downloadBarcode\">\r\n        <span>Download </span>\r\n        <font-awesome-icon icon=\"download\" style=\"color: #ffffff;\" />\r\n      </button>\r\n    </div>\r\n    <!-- Toggle for controlling visibility of the product name -->\r\n    <div class=\"row\">\r\n      <label class=\"show-name-label\">\r\n        <input type=\"checkbox\" v-model=\"showProductName\" />\r\n        <span class=\"text-secondary\">Show Product Name</span>\r\n      </label>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.error-message {\r\n  color: red;\r\n  font-weight: bold;\r\n  margin-top: 10px;\r\n}\r\n\r\n.product-name {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  text-align: center;\r\n  font-size: 12px;\r\n  margin-top: 5px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: black;\r\n  font-weight: bold;\r\n  word-break: break-word;\r\n  max-width: 80%;\r\n}\r\n.show-name-label {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.show-name-label input {\r\n  margin-right: 8px;\r\n}\r\n</style>\r\n"],"mappings":";;EA0IOA,KAAK,EAAC;AAAU;;EACdA,KAAK,EAAC;AAAK;;EA3IpBC,GAAA;EA4I+BD,KAAK,EAAC;;;EA5IrCC,GAAA;EA8IkCD,KAAK,EAAC;;;EAE/BA,KAAK,EAAC;AAAe;;EAOrBA,KAAK,EAAC;AAAK;;EACPA,KAAK,EAAC;AAAiB;;;uBAdlCE,mBAAA,CAmBM,OAnBNC,UAmBM,GAlBJC,mBAAA,CAIM,OAJNC,UAIM,GAHOC,MAAA,CAAAC,YAAY,I,cAAvBL,mBAAA,CAAuE,OAAvEM,UAAuE,EAAAC,gBAAA,CAArBH,MAAA,CAAAC,YAAY,oBA5IpEG,mBAAA,iB,cA6IMR,mBAAA,CAAmC;IAA9BS,GAAG,EAAC,QAAQ;IAAEV,GAAG,EAAEW,MAAA,CAAAC;OACbP,MAAA,CAAAQ,eAAe,I,cAA1BZ,mBAAA,CAAoF,OAApFa,UAAoF,EAAAN,gBAAA,CAApBG,MAAA,CAAAI,WAAW,oBA9IjFN,mBAAA,e,GAgJIN,mBAAA,CAKM,OALNa,UAKM,GAJJb,mBAAA,CAGS;IAHDJ,KAAK,EAAC,sBAAsB;IAAEkB,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEd,MAAA,CAAAe,eAAA,IAAAf,MAAA,CAAAe,eAAA,IAAAD,IAAA,CAAe;gCAC1DhB,mBAAA,CAAsB,cAAhB,WAAS,sBACfkB,YAAA,CAA6DC,4BAAA;IAA1CC,IAAI,EAAC,UAAU;IAACC,KAAuB,EAAvB;MAAA;IAAA;UAGvCf,mBAAA,2DAA8D,EAC9DN,mBAAA,CAKM,OALNsB,UAKM,GAJJtB,mBAAA,CAGQ,SAHRuB,UAGQ,G,gBAFNvB,mBAAA,CAAmD;IAA5CwB,IAAI,EAAC,UAAU;IAzJ9B,uBAAAT,MAAA,QAAAA,MAAA,MAAAU,MAAA,IAyJwCvB,MAAA,CAAAQ,eAAe,GAAAe,MAAA;qDAAfvB,MAAA,CAAAQ,eAAe,E,6BAC/CV,mBAAA,CAAqD;IAA/CJ,KAAK,EAAC;EAAgB,GAAC,mBAAiB,qB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/esnext.iterator.map.js\";\nimport { ref, onMounted, onBeforeUnmount, nextTick } from \"vue\";\nimport Chart from \"chart.js/auto\";\nimport axios from \"axios\";\nimport Navbar from \"/src/components/Admin/Navbar.vue\";\nimport Swal from \"sweetalert2\";\nimport ClipLoader from 'vue-spinner/src/ClipLoader.vue';\nexport default {\n  components: {\n    Navbar,\n    ClipLoader\n  },\n  setup() {\n    const chartCanvas = ref(null);\n    let chartInstance = null;\n    const apiURL = process.env.VUE_APP_URL;\n    // Initialize statistics as ref variables\n    const totalItemsSold = ref(0);\n    const totalSales = ref(0);\n    const totalProfit = ref(0);\n    const totalLost = ref(0);\n    const totalTransactions = ref(0);\n    const totalCompletedTransactions = ref(0);\n    const totalVoidedTransactions = ref(0);\n    const totalReturnedTransactions = ref(0);\n    const isTransactionOpen = ref(false);\n    const dateRange = ref({\n      startDate: null,\n      endDate: null\n    });\n    const loading = ref(false);\n    const isLoading = ref(false);\n    const transactions = ref([]);\n    const products = ref([]);\n    const getTransactions = async () => {\n      loading.value = true;\n      try {\n        const reponse = await axios.get(`${apiURL}/get_all_transactions`);\n        if (reponse.data.success) {\n          transactions.value = reponse.data.transactions;\n        } else {\n          Swal.fire('Eror', 'Failed to get all transaction', 'error');\n        }\n      } catch (error) {\n        console.error(error);\n        Swal.fire('Error', 'Something went wrong', 'error');\n      } finally {\n        loading.value = false;\n      }\n    };\n    const getFastMovingProducts = async () => {\n      try {\n        const response = await axios.get(`${apiURL}/get_fast_moving`); // Adjust API endpoint as necessary\n        products.value = response.data;\n      } catch (error) {\n        console.error('Error fetching fast-moving products:', error);\n      }\n    };\n    // Function to render the chart after data is fetched\n    const renderChart = salesData => {\n      if (salesData.length > 0 && chartCanvas.value) {\n        const labels = salesData.map(data => data._id); // Assuming '_id' as labels\n        const totalSalesData = salesData.map(data => data.totalSales);\n        const totalProfitData = salesData.map(data => data.totalProfit);\n        const ctx = chartCanvas.value.getContext(\"2d\"); // Get the context for the canvas element\n\n        // Destroy existing chart instance before creating a new one\n        if (chartInstance) {\n          chartInstance.destroy();\n        }\n\n        // Initialize the chart with the provided data\n        chartInstance = new Chart(ctx, {\n          type: \"bar\",\n          data: {\n            labels: labels,\n            datasets: [{\n              label: \"Total Sales\",\n              data: totalSalesData,\n              backgroundColor: \"rgb(40, 199, 111)\",\n              borderColor: \"rgb(75, 192, 192)\",\n              borderWidth: 1\n            }, {\n              label: \"Total Profit\",\n              data: totalProfitData,\n              backgroundColor: \"rgb(255, 77, 77)\",\n              borderColor: \"rgb(255, 99, 132)\",\n              borderWidth: 1\n            }]\n          },\n          options: {\n            responsive: true,\n            plugins: {\n              legend: {\n                position: \"top\"\n              },\n              tooltip: {\n                enabled: true\n              }\n            },\n            scales: {\n              x: {\n                title: {\n                  display: true,\n                  text: \"Dates\"\n                }\n              },\n              y: {\n                title: {\n                  display: true,\n                  text: \"Values\"\n                },\n                beginAtZero: true\n              }\n            }\n          }\n        });\n      }\n    };\n\n    // Fetch transaction state (open or closed)\n    const updateTransactionState = async () => {\n      try {\n        const response = await axios.get(`${apiURL}/transaction_state`);\n        if (response.data.success) {\n          isTransactionOpen.value = response.data.isOpen; // This should reflect the correct state\n        } else {\n          console.error(\"Failed to fetch transaction state.\");\n        }\n      } catch (error) {\n        console.error(\"Error fetching transaction state:\", error);\n        Swal.fire({\n          title: \"Error!\",\n          text: \"Failed to update transaction state\",\n          icon: \"error\",\n          confirmButtonText: \"OK\"\n        });\n      }\n    };\n    const toggleTransaction = async () => {\n      const action = isTransactionOpen.value ? \"close\" : \"open\";\n      try {\n        const result = await Swal.fire({\n          title: \"Confirm Action\",\n          text: `Are you sure you want to ${action} the transaction?`,\n          icon: \"question\",\n          showCancelButton: true,\n          confirmButtonText: \"Yes\",\n          cancelButtonText: \"No\"\n        });\n        if (result.isConfirmed) {\n          const endpoint = `${action}_transaction`;\n          const response = await axios.post(`${apiURL}/${endpoint}`);\n          if (response.data.success) {\n            isTransactionOpen.value = !isTransactionOpen.value;\n            await Swal.fire({\n              title: \"Success!\",\n              text: `Transaction ${action}ed successfully`,\n              icon: \"success\",\n              confirmButtonText: \"OK\"\n            });\n\n            // Reset data if the transaction was opened\n            if (isTransactionOpen.value) {\n              // Reset statistics and chart data\n              totalItemsSold.value = 0;\n              totalSales.value = 0;\n              totalProfit.value = 0;\n              totalLost.value = 0;\n              totalTransactions.value = 0;\n              totalCompletedTransactions.value = 0;\n              totalVoidedTransactions.value = 0;\n              totalReturnedTransactions.value = 0;\n              dateRange.value = {\n                startDate: null,\n                endDate: null\n              };\n\n              // Reload statistics and chart data\n              await fetchStatistics();\n            } else {\n              // Optionally, fetch statistics again when transaction is closed\n              await fetchStatistics();\n            }\n          } else {\n            throw new Error(response.data.message || `Failed to ${action} transaction`);\n          }\n        }\n      } catch (error) {\n        console.error(`Error ${action}ing transaction:`, error);\n        Swal.fire({\n          title: \"Error!\",\n          text: error.message,\n          icon: \"error\",\n          confirmButtonText: \"OK\"\n        });\n      }\n    };\n    const fetchStatistics = async () => {\n      try {\n        isLoading.value = true;\n        const response = await axios.get(`${apiURL}/get_statistics`);\n        if (response.data.success) {\n          const statistics = response.data.statistics;\n\n          // Set the statistics values\n          totalTransactions.value = statistics.totalTransactions;\n          totalCompletedTransactions.value = statistics.totalCompletedTransactions;\n          totalVoidedTransactions.value = statistics.totalVoidedTransactions;\n          totalReturnedTransactions.value = statistics.totalReturnedTransactions;\n          totalSales.value = statistics.totalSalesAmount;\n          totalProfit.value = statistics.totalProfitAmount;\n          totalLost.value = statistics.totalLossAmount;\n          totalItemsSold.value = statistics.totalItemsSold;\n          dateRange.value = statistics.dateRange || {\n            startDate: null,\n            endDate: null\n          };\n        } else {\n          console.error(\"Failed to fetch dashboard statistics\");\n        }\n\n        // Fetch the sales data for the chart\n        const chartResponse = await axios.get(`${apiURL}/get_sales`);\n        if (chartResponse.data.success) {\n          const salesData = chartResponse.data.salesDatas;\n          renderChart(salesData); // Render the chart once the data is fetched\n        } else {\n          console.error(\"Failed to fetch sales data for chart\");\n        }\n      } catch (error) {\n        console.error(\"Error fetching statistics:\", error);\n        Swal.fire({\n          title: \"Error!\",\n          text: \"Failed to fetch dashboard data\",\n          icon: \"error\",\n          confirmButtonText: \"OK\"\n        });\n      } finally {\n        isLoading.value = false;\n      }\n    };\n    // On component mount, fetch initial data\n    onMounted(async () => {\n      await updateTransactionState();\n      await fetchStatistics();\n      await getTransactions();\n      getFastMovingProducts;\n    });\n\n    // Clean up the chart instance when the component is unmounted\n    onBeforeUnmount(() => {\n      if (chartInstance) {\n        chartInstance.destroy();\n      }\n    });\n    return {\n      chartCanvas,\n      totalItemsSold,\n      totalSales,\n      totalProfit,\n      totalLost,\n      totalTransactions,\n      totalCompletedTransactions,\n      totalVoidedTransactions,\n      totalReturnedTransactions,\n      dateRange,\n      isTransactionOpen,\n      toggleTransaction,\n      getTransactions,\n      transactions,\n      products\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","onBeforeUnmount","nextTick","Chart","axios","Navbar","Swal","ClipLoader","components","setup","chartCanvas","chartInstance","apiURL","process","env","VUE_APP_URL","totalItemsSold","totalSales","totalProfit","totalLost","totalTransactions","totalCompletedTransactions","totalVoidedTransactions","totalReturnedTransactions","isTransactionOpen","dateRange","startDate","endDate","loading","isLoading","transactions","products","getTransactions","value","reponse","get","data","success","fire","error","console","getFastMovingProducts","response","renderChart","salesData","length","labels","map","_id","totalSalesData","totalProfitData","ctx","getContext","destroy","type","datasets","label","backgroundColor","borderColor","borderWidth","options","responsive","plugins","legend","position","tooltip","enabled","scales","x","title","display","text","y","beginAtZero","updateTransactionState","isOpen","icon","confirmButtonText","toggleTransaction","action","result","showCancelButton","cancelButtonText","isConfirmed","endpoint","post","fetchStatistics","Error","message","statistics","totalSalesAmount","totalProfitAmount","totalLossAmount","chartResponse","salesDatas"],"sources":["C:\\Users\\Administrator\\OneDrive\\Desktop\\POSExpress\\frontend\\src\\components\\Admin\\Main\\Dashboard.vue"],"sourcesContent":["<template>\r\n  <Navbar />\r\n\r\n  <div class=\"page-wrapper\">\r\n    <div class=\"content\">\r\n      <div class=\"row mb-3\">\r\n        <div class=\"col-12 d-flex justify-content-end\">\r\n          <button @click=\"toggleTransaction\" :class=\"['btn', isTransactionOpen ? 'btn-danger' : 'btn-success']\">\r\n            {{ isTransactionOpen ? 'Close Transaction' : 'Open Transaction' }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"row\">\r\n      <!-- Total Items Sold -->\r\n\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-widget w-100\">\r\n          <div class=\"dash-widgetimg\">\r\n            <span><img src=\"assets/img/icons/dash1.svg\" alt=\"img\" /></span>\r\n          </div>\r\n          <div class=\"dash-widgetcontent\">\r\n            \r\n            <h5>\r\n              <span class=\"counters\">{{ totalItemsSold }}</span>\r\n            </h5>\r\n            <h6>Total Items Sold</h6>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Total Sales -->\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-widget dash1 w-100\">\r\n          <div class=\"dash-widgetimg\">\r\n            <span><img src=\"assets/img/icons/dash2.svg\" alt=\"img\" /></span>\r\n          </div>\r\n          <div class=\"dash-widgetcontent\">\r\n            <h5>\r\n              <font-awesome-icon icon=\"fa-peso-sign\" />\r\n              <span class=\"counters\">{{ totalSales.toFixed(2) }}</span>\r\n            </h5>\r\n            <h6>Total Sales</h6>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Total Profit -->\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-widget dash2 w-100\">\r\n          <div class=\"dash-widgetimg\">\r\n            <span>\r\n              <font-awesome-icon icon=\"fa-arrow-trend-up\" :size=\"'2x'\" style=\"color: #74C0FC;\" />\r\n            </span>\r\n          </div>\r\n          <div class=\"dash-widgetcontent\">\r\n            <h5>\r\n              <font-awesome-icon icon=\"fa-peso-sign\" />\r\n              <span class=\"counters\">{{ totalProfit.toFixed(2) }}</span>\r\n            </h5>\r\n            <h6>Total Profit</h6>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Total Lost -->\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-widget dash3 w-100\">\r\n          <div class=\"dash-widgetimg\">\r\n            <span>\r\n              <font-awesome-icon icon=\"fa-arrow-trend-down\" :size=\"'2x'\" style=\"color: #ee3a5e;\" />\r\n            </span>\r\n          </div>\r\n          <div class=\"dash-widgetcontent\">\r\n            <h5>\r\n              <font-awesome-icon icon=\"fa-peso-sign\" />\r\n              <span class=\"counters\">{{ totalLost.toFixed(2) }}</span>\r\n            </h5>\r\n            <h6>Total Lost</h6>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Total Transactions -->\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-count\">\r\n          <div class=\"dash-counts\">\r\n            <h4>{{ totalTransactions }}</h4>\r\n            <h5>Transactions</h5>\r\n          </div>\r\n          <div class=\"dash-imgs\">\r\n            <font-awesome-icon icon=\"fa-handshake\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Total Returns -->\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-count badge-bgprimary\">\r\n          <div class=\"dash-counts\">\r\n            <h4>{{ totalReturnedTransactions }}</h4>\r\n            <h5>Returns</h5>\r\n          </div>\r\n          <div class=\"dash-imgs\">\r\n            <font-awesome-icon icon=\"fa-reply\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Total Purchase Invoice -->\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-count das2 bg-danger\">\r\n          <div class=\"dash-counts\">\r\n            <h4>{{ totalVoidedTransactions }}</h4>\r\n            <h5>Void Purchases</h5>\r\n          </div>\r\n          <div class=\"dash-imgs\">\r\n            <font-awesome-icon icon=\"fa-ban\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Completed Transactions -->\r\n      <div class=\"col-xl-3 col-sm-6 col-12 d-flex\">\r\n        <div class=\"dash-count das3\">\r\n          <div class=\"dash-counts\">\r\n            <h4>{{ totalCompletedTransactions }}</h4>\r\n            <h5>Completed transactions</h5>\r\n          </div>\r\n          <div class=\"dash-imgs\">\r\n            <font-awesome-icon icon=\"fa-clipboard-check\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n      <div class=\"row\">\r\n        <div class=\"col-xl-7 col-sm-12 col-12 d-flex\">\r\n          <div class=\"card flex-fill\">\r\n            <div class=\"card-header d-flex justify-content-between align-items-center\">\r\n              <h5 class=\"card-title mb-0\">Purchase & Sales</h5>\r\n              <div class=\"graph-sets\">\r\n\r\n                <div class=\"dropdown dropdown-wraper\">\r\n                  <button class=\"btn btn-light btn-sm dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\"\r\n                    data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                    2023\r\n                  </button>\r\n                  <ul class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\r\n                    <li>\r\n                      <a href=\"javascript:void(0);\" class=\"dropdown-item\">2023</a>\r\n                    </li>\r\n                    <li>\r\n                      <a href=\"javascript:void(0);\" class=\"dropdown-item\">2022</a>\r\n                    </li>\r\n                    <li>\r\n                      <a href=\"javascript:void(0);\" class=\"dropdown-item\">2021</a>\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"card-body\">\r\n              <canvas ref=\"chartCanvas\"></canvas>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-xl-5 col-sm-12 col-12 d-flex\">\r\n          <div class=\"card flex-fill default-cover mb-4\">\r\n            <div class=\"card-header d-flex justify-content-between align-items-center\">\r\n              <h4 class=\"card-title mb-0\">Recent Transactions</h4>\r\n              <div class=\"view-all-link\">\r\n                <a href=\"javascript:void(0);\" class=\"view-all d-flex align-items-center\">\r\n                  View All<span class=\"ps-2 d-flex align-items-center\"><i data-feather=\"arrow-right\"\r\n                      class=\"feather-16\"></i></span>\r\n                </a>\r\n              </div>\r\n            </div>\r\n            <div class=\"card-body\">\r\n              <div class=\"table-responsive dataview\">\r\n                <ClipLoader v-if=\"loading\" />\r\n                <table v-else class=\"table datanew\">\r\n            <thead>\r\n              <tr>\r\n                <th>Transaction ID</th>\r\n                <th>Status</th>\r\n                <th>Date</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody class=\"sales-list\">\r\n    <tr v-if=\"transactions.length <= 0\">\r\n      <td colspan=\"3\">No transactions available</td>\r\n    </tr>\r\n    <tr v-else v-for=\"trans in transactions.slice(0, 5)\" :key=\"trans.id\">\r\n      <td>{{ trans.transactionId }}</td>\r\n\r\n      <td class=\"text-center\">\r\n        <span :class=\"{\r\n          'badge': true,\r\n          'badge-bgsuccess': trans.status === 'Completed',\r\n          'badge-bgdanger': trans.status === 'Voided',\r\n          'badge-bgprimary': trans.status === 'Returned'\r\n        }\">\r\n          {{ trans.status }}\r\n        </span>\r\n      </td>\r\n\r\n      <td>{{ $formatDate(trans.createdAt) }}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"card\">\r\n        <div class=\"card-header\">\r\n          <h4 class=\"card-title\">Fast Moving Products</h4>\r\n        </div>\r\n        <div class=\"card-body\">\r\n          <div class=\"table-responsive dataview\">\r\n            <table class=\"table dashboard-expired-products\">\r\n              <thead>\r\n          <tr>\r\n            <th>SKU</th>\r\n            <th>Product Name</th>\r\n            <th>Sales</th>\r\n            <th>Quantity</th>\r\n            <th>Total Sales</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"product in products.slice(0, 5)\" :key=\"product.sku\">\r\n            <td>{{ product.sku }}</td>\r\n            <td>{{ product.name }}</td>\r\n            <td>{{ product.price.toFixed(2) }}</td>\r\n            <td>{{ product.sales }}</td>\r\n            <td>{{ product.quantity }}</td>\r\n            <td>{{ product.totalSales.toFixed(2) }}</td>\r\n          </tr>\r\n        </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  \r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, onBeforeUnmount,nextTick } from \"vue\";\r\nimport Chart from \"chart.js/auto\";\r\nimport axios from \"axios\";\r\nimport Navbar from \"/src/components/Admin/Navbar.vue\";\r\nimport Swal from \"sweetalert2\";\r\nimport ClipLoader from 'vue-spinner/src/ClipLoader.vue';\r\n\r\n\r\nexport default {\r\n  components: {\r\n    Navbar,\r\n    ClipLoader\r\n  },\r\n  setup() {\r\n    const chartCanvas = ref(null);\r\n    let chartInstance = null;\r\n    const apiURL = process.env.VUE_APP_URL;\r\n    // Initialize statistics as ref variables\r\n    const totalItemsSold = ref(0);\r\n    const totalSales = ref(0);\r\n    const totalProfit = ref(0);\r\n    const totalLost = ref(0);\r\n    const totalTransactions = ref(0);\r\n    const totalCompletedTransactions = ref(0);\r\n    const totalVoidedTransactions = ref(0);\r\n    const totalReturnedTransactions = ref(0);\r\n    const isTransactionOpen = ref(false);\r\n    const dateRange = ref({ startDate: null, endDate: null });\r\n    const loading = ref(false);\r\n    const isLoading = ref(false);\r\n    const transactions = ref([]);\r\n    const products = ref([]);\r\n\r\n    const getTransactions = async () => {\r\n      loading.value = true;\r\n      try {\r\n        const reponse = await axios.get(`${apiURL}/get_all_transactions`);\r\n        if (reponse.data.success) {\r\n          transactions.value = reponse.data.transactions\r\n        } else {\r\n          Swal.fire('Eror', 'Failed to get all transaction', 'error');\r\n        }\r\n\r\n      } catch (error) {\r\n        console.error(error);\r\n        Swal.fire('Error', 'Something went wrong', 'error');\r\n      } finally {\r\n        loading.value = false;\r\n      }\r\n    }\r\n\r\n     const  getFastMovingProducts=  async () => {\r\n      try {\r\n        const response = await axios.get(`${apiURL}/get_fast_moving`); // Adjust API endpoint as necessary\r\n        products.value = response.data;\r\n      } catch (error) {\r\n        console.error('Error fetching fast-moving products:', error);\r\n      }\r\n    }\r\n    // Function to render the chart after data is fetched\r\n    const renderChart = (salesData) => {\r\n      if (salesData.length > 0 && chartCanvas.value) {\r\n        const labels = salesData.map((data) => data._id); // Assuming '_id' as labels\r\n        const totalSalesData = salesData.map((data) => data.totalSales);\r\n        const totalProfitData = salesData.map((data) => data.totalProfit);\r\n\r\n        const ctx = chartCanvas.value.getContext(\"2d\"); // Get the context for the canvas element\r\n\r\n        // Destroy existing chart instance before creating a new one\r\n        if (chartInstance) {\r\n          chartInstance.destroy();\r\n        }\r\n\r\n        // Initialize the chart with the provided data\r\n        chartInstance = new Chart(ctx, {\r\n          type: \"bar\",\r\n          data: {\r\n            labels: labels,\r\n            datasets: [\r\n              {\r\n                label: \"Total Sales\",\r\n                data: totalSalesData,\r\n                backgroundColor: \"rgb(40, 199, 111)\",\r\n                borderColor: \"rgb(75, 192, 192)\",\r\n                borderWidth: 1,\r\n              },\r\n              {\r\n                label: \"Total Profit\",\r\n                data: totalProfitData,\r\n                backgroundColor: \"rgb(255, 77, 77)\",\r\n                borderColor: \"rgb(255, 99, 132)\",\r\n                borderWidth: 1,\r\n              },\r\n            ],\r\n          },\r\n          options: {\r\n            responsive: true,\r\n            plugins: {\r\n              legend: {\r\n                position: \"top\",\r\n              },\r\n              tooltip: {\r\n                enabled: true,\r\n              },\r\n            },\r\n            scales: {\r\n              x: {\r\n                title: {\r\n                  display: true,\r\n                  text: \"Dates\",\r\n                },\r\n              },\r\n              y: {\r\n                title: {\r\n                  display: true,\r\n                  text: \"Values\",\r\n                },\r\n                beginAtZero: true,\r\n              },\r\n            },\r\n          },\r\n        });\r\n      }\r\n    };\r\n\r\n    // Fetch transaction state (open or closed)\r\n    const updateTransactionState = async () => {\r\n  try {\r\n    const response = await axios.get(`${apiURL}/transaction_state`);\r\n    if (response.data.success) {\r\n      isTransactionOpen.value = response.data.isOpen;  // This should reflect the correct state\r\n    } else {\r\n      console.error(\"Failed to fetch transaction state.\");\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error fetching transaction state:\", error);\r\n    Swal.fire({\r\n      title: \"Error!\",\r\n      text: \"Failed to update transaction state\",\r\n      icon: \"error\",\r\n      confirmButtonText: \"OK\",\r\n    });\r\n  }\r\n};\r\n\r\nconst toggleTransaction = async () => {\r\n  const action = isTransactionOpen.value ? \"close\" : \"open\";\r\n  try {\r\n    const result = await Swal.fire({\r\n      title: \"Confirm Action\",\r\n      text: `Are you sure you want to ${action} the transaction?`,\r\n      icon: \"question\",\r\n      showCancelButton: true,\r\n      confirmButtonText: \"Yes\",\r\n      cancelButtonText: \"No\",\r\n    });\r\n\r\n    if (result.isConfirmed) {\r\n      const endpoint = `${action}_transaction`;\r\n      const response = await axios.post(`${apiURL}/${endpoint}`);\r\n\r\n      if (response.data.success) {\r\n        isTransactionOpen.value = !isTransactionOpen.value;\r\n        await Swal.fire({\r\n          title: \"Success!\",\r\n          text: `Transaction ${action}ed successfully`,\r\n          icon: \"success\",\r\n          confirmButtonText: \"OK\",\r\n        });\r\n\r\n        // Reset data if the transaction was opened\r\n        if (isTransactionOpen.value) {\r\n          // Reset statistics and chart data\r\n          totalItemsSold.value = 0;\r\n          totalSales.value = 0;\r\n          totalProfit.value = 0;\r\n          totalLost.value = 0;\r\n          totalTransactions.value = 0;\r\n          totalCompletedTransactions.value = 0;\r\n          totalVoidedTransactions.value = 0;\r\n          totalReturnedTransactions.value = 0;\r\n          dateRange.value = { startDate: null, endDate: null };\r\n\r\n          // Reload statistics and chart data\r\n          await fetchStatistics();\r\n        } else {\r\n          // Optionally, fetch statistics again when transaction is closed\r\n          await fetchStatistics();\r\n        }\r\n      } else {\r\n        throw new Error(response.data.message || `Failed to ${action} transaction`);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error(`Error ${action}ing transaction:`, error);\r\n    Swal.fire({\r\n      title: \"Error!\",\r\n      text: error.message,\r\n      icon: \"error\",\r\n      confirmButtonText: \"OK\",\r\n    });\r\n  }\r\n};\r\n\r\n\r\nconst fetchStatistics = async () => {\r\n  try {\r\n    isLoading.value = true;\r\n\r\n    const response = await axios.get(`${apiURL}/get_statistics`);\r\n    if (response.data.success) {\r\n      const statistics = response.data.statistics;\r\n\r\n      // Set the statistics values\r\n      totalTransactions.value = statistics.totalTransactions;\r\n      totalCompletedTransactions.value = statistics.totalCompletedTransactions;\r\n      totalVoidedTransactions.value = statistics.totalVoidedTransactions;\r\n      totalReturnedTransactions.value = statistics.totalReturnedTransactions;\r\n      totalSales.value = statistics.totalSalesAmount;\r\n      totalProfit.value = statistics.totalProfitAmount;\r\n      totalLost.value = statistics.totalLossAmount;\r\n      totalItemsSold.value = statistics.totalItemsSold;\r\n      dateRange.value = statistics.dateRange || { startDate: null, endDate: null };\r\n    } else {\r\n      console.error(\"Failed to fetch dashboard statistics\");\r\n    }\r\n\r\n    // Fetch the sales data for the chart\r\n    const chartResponse = await axios.get(`${apiURL}/get_sales`);\r\n    if (chartResponse.data.success) {\r\n      const salesData = chartResponse.data.salesDatas;\r\n      renderChart(salesData); // Render the chart once the data is fetched\r\n    } else {\r\n      console.error(\"Failed to fetch sales data for chart\");\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error fetching statistics:\", error);\r\n    Swal.fire({\r\n      title: \"Error!\",\r\n      text: \"Failed to fetch dashboard data\",\r\n      icon: \"error\",\r\n      confirmButtonText: \"OK\",\r\n    });\r\n  } finally {\r\n    isLoading.value = false;\r\n  }\r\n};\r\n    // On component mount, fetch initial data\r\n    onMounted(async () => {\r\n      await updateTransactionState();\r\n      await fetchStatistics();\r\n      await getTransactions();\r\n      getFastMovingProducts\r\n    });\r\n\r\n    // Clean up the chart instance when the component is unmounted\r\n    onBeforeUnmount(() => {\r\n      if (chartInstance) {\r\n        chartInstance.destroy();\r\n      }\r\n    });\r\n\r\n    return {\r\n      chartCanvas,\r\n      totalItemsSold,\r\n      totalSales,\r\n      totalProfit,\r\n      totalLost,\r\n      totalTransactions,\r\n      totalCompletedTransactions,\r\n      totalVoidedTransactions,\r\n      totalReturnedTransactions,\r\n      dateRange,\r\n      isTransactionOpen,\r\n      toggleTransaction,\r\n      getTransactions,\r\n      transactions,\r\n      products\r\n    };\r\n  },\r\n};\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
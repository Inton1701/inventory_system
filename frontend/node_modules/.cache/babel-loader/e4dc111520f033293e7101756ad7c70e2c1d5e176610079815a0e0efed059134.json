{"ast":null,"code":"import \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport JsBarcode from 'jsbarcode';\nimport { onMounted, watch, ref, nextTick } from 'vue';\nimport debounce from 'lodash.debounce';\nexport default {\n  props: {\n    sku: {\n      type: String,\n      default: '',\n      validator: value => /^\\d{0,13}$/.test(value) // Validate SKU is numeric and max 13 characters\n    },\n    productName: {\n      type: String,\n      default: 'Product Name' // Default label if no product name is provided\n    }\n  },\n  setup(props) {\n    const svgRef = ref(null);\n    const errorMessage = ref('');\n    const fallbackSku = '0000000000000';\n    const showProductName = ref(true); // Boolean to control visibility of product name\n\n    const calculateEAN13Checksum = sku => {\n      const digits = sku.split('').map(Number);\n      let sum = 0;\n      for (let i = 0; i < 12; i++) {\n        sum += i % 2 === 0 ? digits[i] : digits[i] * 3;\n      }\n      return (10 - sum % 10) % 10;\n    };\n    const generateBarcode = sku => {\n      requestAnimationFrame(() => {\n        try {\n          // Use fallback SKU if no valid SKU is provided\n          if (!sku || typeof sku !== 'string' || sku.length === 0) {\n            sku = fallbackSku;\n          }\n          if (sku.length < 13) {\n            sku = sku.padStart(13, '0');\n          } else if (sku.length > 13) {\n            sku = sku.slice(0, 13);\n          }\n          const checksum = calculateEAN13Checksum(sku);\n          sku = sku.slice(0, 12) + checksum;\n          errorMessage.value = '';\n          JsBarcode(svgRef.value, sku, {\n            format: 'EAN13',\n            lineColor: '#000',\n            width: 2,\n            height: 50,\n            displayValue: true\n          });\n        } catch (error) {\n          console.error(error.message);\n          errorMessage.value = error.message;\n          JsBarcode(svgRef.value, fallbackSku, {\n            format: 'CODE128',\n            lineColor: '#000',\n            width: 2,\n            height: 50,\n            displayValue: true\n          });\n        }\n      });\n    };\n    const debouncedGenerateBarcode = debounce(generateBarcode, 300);\n    const sanitizeFileName = name => {\n      return name.replace(/[\\/:*?\"<>|]/g, '_').replace(/\\s+/g, '_');\n    };\n    const downloadBarcode = () => {\n      const svg = svgRef.value;\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      const svgData = new XMLSerializer().serializeToString(svg);\n      const img = new Image();\n      const svgBlob = new Blob([svgData], {\n        type: 'image/svg+xml;charset=utf-8'\n      });\n      const url = URL.createObjectURL(svgBlob);\n      img.onload = () => {\n        canvas.width = img.width;\n        canvas.height = img.height + (showProductName.value ? 30 : 0); // Adjust canvas height based on visibility of product name\n        ctx.fillStyle = 'white';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n        // Draw the barcode image on the canvas\n        ctx.drawImage(img, 0, 0);\n\n        // If showProductName is true, draw the product name\n        if (showProductName.value) {\n          ctx.font = '12px Arial';\n          ctx.fillStyle = 'black';\n          ctx.textAlign = 'center';\n          ctx.fillText(props.productName, canvas.width / 2, img.height + 20);\n        }\n\n        // Sanitize the product name for use in the file name\n        const sanitizedProductName = sanitizeFileName(props.productName);\n        const pngUrl = canvas.toDataURL('image/png');\n        const link = document.createElement('a');\n        link.href = pngUrl;\n        link.download = `${sanitizedProductName}_barcode.png`; // Use sanitized product name as the file name\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n      };\n      img.src = url;\n    };\n    onMounted(() => generateBarcode(props.sku));\n    watch(() => props.sku, newSku => {\n      debouncedGenerateBarcode(newSku);\n    }, {\n      immediate: true\n    } // Trigger barcode generation on mount\n    );\n    return {\n      svgRef,\n      errorMessage,\n      downloadBarcode,\n      showProductName // Return this so it can be used in the template\n    };\n  }\n};","map":{"version":3,"names":["JsBarcode","onMounted","watch","ref","nextTick","debounce","props","sku","type","String","default","validator","value","test","productName","setup","svgRef","errorMessage","fallbackSku","showProductName","calculateEAN13Checksum","digits","split","map","Number","sum","i","generateBarcode","requestAnimationFrame","length","padStart","slice","checksum","format","lineColor","width","height","displayValue","error","console","message","debouncedGenerateBarcode","sanitizeFileName","name","replace","downloadBarcode","svg","canvas","document","createElement","ctx","getContext","svgData","XMLSerializer","serializeToString","img","Image","svgBlob","Blob","url","URL","createObjectURL","onload","fillStyle","fillRect","drawImage","font","textAlign","fillText","sanitizedProductName","pngUrl","toDataURL","link","href","download","body","appendChild","click","removeChild","revokeObjectURL","src","newSku","immediate"],"sources":["C:\\Users\\Administrator\\OneDrive\\Desktop\\POSExpress\\frontend\\src\\components\\Admin\\Inventory\\Barcode.vue"],"sourcesContent":["<script>\r\nimport JsBarcode from 'jsbarcode';\r\nimport { onMounted, watch, ref, nextTick } from 'vue';\r\nimport debounce from 'lodash.debounce';\r\n\r\nexport default {\r\n  props: {\r\n    sku: {\r\n      type: String,\r\n      default: '',\r\n      validator: (value) => /^\\d{0,13}$/.test(value) // Validate SKU is numeric and max 13 characters\r\n    },\r\n    productName: {\r\n      type: String,\r\n      default: 'Product Name' // Default label if no product name is provided\r\n    }\r\n  },\r\n  setup(props) {\r\n    const svgRef = ref(null);\r\n    const errorMessage = ref('');\r\n    const fallbackSku = '0000000000000';\r\n    const showProductName = ref(true); // Boolean to control visibility of product name\r\n\r\n    const calculateEAN13Checksum = (sku) => {\r\n      const digits = sku.split('').map(Number);\r\n      let sum = 0;\r\n      for (let i = 0; i < 12; i++) {\r\n        sum += (i % 2 === 0 ? digits[i] : digits[i] * 3);\r\n      }\r\n      return (10 - (sum % 10)) % 10;\r\n    };\r\n\r\n    const generateBarcode = (sku) => {\r\n      requestAnimationFrame(() => {\r\n        try {\r\n          // Use fallback SKU if no valid SKU is provided\r\n          if (!sku || typeof sku !== 'string' || sku.length === 0) {\r\n            sku = fallbackSku;\r\n          }\r\n\r\n          if (sku.length < 13) {\r\n            sku = sku.padStart(13, '0');\r\n          } else if (sku.length > 13) {\r\n            sku = sku.slice(0, 13);\r\n          }\r\n\r\n          const checksum = calculateEAN13Checksum(sku);\r\n          sku = sku.slice(0, 12) + checksum;\r\n          errorMessage.value = '';\r\n\r\n          JsBarcode(svgRef.value, sku, {\r\n            format: 'EAN13',\r\n            lineColor: '#000',\r\n            width: 2,\r\n            height: 50,\r\n            displayValue: true\r\n          });\r\n        } catch (error) {\r\n          console.error(error.message);\r\n          errorMessage.value = error.message;\r\n\r\n          JsBarcode(svgRef.value, fallbackSku, {\r\n            format: 'CODE128',\r\n            lineColor: '#000',\r\n            width: 2,\r\n            height: 50,\r\n            displayValue: true\r\n          });\r\n        }\r\n      });\r\n    };\r\n\r\n    const debouncedGenerateBarcode = debounce(generateBarcode, 300);\r\n\r\n    const sanitizeFileName = (name) => {\r\n      return name.replace(/[\\/:*?\"<>|]/g, '_').replace(/\\s+/g, '_');\r\n    };\r\n\r\n    const downloadBarcode = () => {\r\n      const svg = svgRef.value;\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      const svgData = new XMLSerializer().serializeToString(svg);\r\n      const img = new Image();\r\n      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\r\n      const url = URL.createObjectURL(svgBlob);\r\n\r\n      img.onload = () => {\r\n        canvas.width = img.width;\r\n        canvas.height = img.height + (showProductName.value ? 30 : 0); // Adjust canvas height based on visibility of product name\r\n        ctx.fillStyle = 'white';\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n        // Draw the barcode image on the canvas\r\n        ctx.drawImage(img, 0, 0);\r\n\r\n        // If showProductName is true, draw the product name\r\n        if (showProductName.value) {\r\n          ctx.font = '12px Arial';\r\n          ctx.fillStyle = 'black';\r\n          ctx.textAlign = 'center';\r\n          ctx.fillText(props.productName, canvas.width / 2, img.height + 20);\r\n        }\r\n\r\n        // Sanitize the product name for use in the file name\r\n        const sanitizedProductName = sanitizeFileName(props.productName);\r\n        const pngUrl = canvas.toDataURL('image/png');\r\n        const link = document.createElement('a');\r\n        link.href = pngUrl;\r\n        link.download = `${sanitizedProductName}_barcode.png`; // Use sanitized product name as the file name\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        URL.revokeObjectURL(url);\r\n      };\r\n      img.src = url;\r\n    };\r\n\r\n    onMounted(() => generateBarcode(props.sku));\r\n    watch(\r\n      () => props.sku,\r\n      (newSku) => {\r\n        debouncedGenerateBarcode(newSku);\r\n      },\r\n      { immediate: true } // Trigger barcode generation on mount\r\n    );\r\n\r\n    return {\r\n      svgRef,\r\n      errorMessage,\r\n      downloadBarcode,\r\n      showProductName // Return this so it can be used in the template\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div class=\"row px-5\">\r\n    <div class=\"row\">\r\n      <div v-if=\"errorMessage\" class=\"error-message\">{{ errorMessage }}</div>\r\n      <svg ref=\"svgRef\" :key=\"sku\"></svg>\r\n      <div v-if=\"showProductName\" class=\"product-name text-center\">{{ productName }}</div>\r\n    </div>\r\n    <div class=\"row ps-4 pe-3\">\r\n      <button class=\"btn btn-primary fs-6\" @click=\"downloadBarcode\">\r\n        <span>Download </span>\r\n        <font-awesome-icon icon=\"download\" style=\"color: #ffffff;\" />\r\n      </button>\r\n    </div>\r\n    <!-- Toggle for controlling visibility of the product name -->\r\n    <div class=\"row\">\r\n      <label class=\"show-name-label\">\r\n        <input type=\"checkbox\" v-model=\"showProductName\" />\r\n        <span class=\"text-secondary\">Show Product Name</span>\r\n      </label>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.error-message {\r\n  color: red;\r\n  font-weight: bold;\r\n  margin-top: 10px;\r\n}\r\n\r\n.product-name {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  text-align: center;\r\n  font-size: 12px;\r\n  margin-top: 5px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: black;\r\n  font-weight: bold;\r\n  word-break: break-word;\r\n  max-width: 80%;\r\n}\r\n.show-name-label {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.show-name-label input {\r\n  margin-right: 8px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}